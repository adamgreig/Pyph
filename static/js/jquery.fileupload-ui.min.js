/*
 * jQuery File Upload User Interface Plugin 4.4.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://creativecommons.org/licenses/MIT/
 */
(function(f){var m,i,n=function(c){var f=0,a=[];this.complete=function(){f+=1;f===a.length+1&&(c(a),f=0,a=[])};this.push=function(f){a.push(f)};this.getList=function(){return a}};m=function(c,h){var a=this,j,i,k=new n(function(g){a.hideProgressBarAll(function(){a.resetProgressBarAll();if(typeof a.onCompleteAll==="function")a.onCompleteAll(g)})}),l=function(g){return typeof g.uploadTable==="function"?g.uploadTable(g):g.uploadTable};this.requestHeaders={Accept:"application/json, text/javascript, */*; q=0.01"};
this.dropZone=c;this.imageTypes=/^image\/(gif|jpeg|png)$/;this.previewMaxWidth=this.previewMaxHeight=80;this.previewLoadDelay=100;this.previewAsCanvas=!0;this.previewSelector=".file_upload_preview";this.progressSelector=".file_upload_progress div";this.cancelSelector=".file_upload_cancel button";this.cssClassSmall="file_upload_small";this.cssClassLarge="file_upload_large";this.cssClassHighlight="file_upload_highlight";this.dropEffect="highlight";this.progressAllNode=this.buildUploadRow=this.buildDownloadRow=
this.uploadTable=this.downloadTable=null;this.loadImage=function(g,a,e,o,b,f){var c,i,h;if(b&&!b.test(g.type))return null;i=function(b){var a=document.createElement("canvas"),g=Math.min((e||b.width)/b.width,(o||b.height)/b.height);g>1&&(g=1);b.width=parseInt(b.width*g,10);b.height=parseInt(b.height*g,10);if(f||typeof a.getContext!=="function")return b;a.width=b.width;a.height=b.height;a.getContext("2d").drawImage(b,0,0,b.width,b.height);return a};c=document.createElement("img");(h=typeof URL!=="undefined"?
URL:typeof webkitURL!=="undefined"?webkitURL:null)&&typeof h.createObjectURL==="function"?(c.onload=function(){h.revokeObjectURL(this.src);a(i(c))},c.src=h.createObjectURL(g)):typeof FileReader!=="undefined"&&typeof FileReader.prototype.readAsDataURL==="function"?(c.onload=function(){a(i(c))},b=new FileReader,b.onload=function(b){c.src=b.target.result},b.readAsDataURL(g)):a(null)};this.addNode=function(a,d,e){a&&a.length&&d&&d.length?d.css("display","none").appendTo(a).fadeIn(function(){if(typeof e===
"function")try{e()}catch(a){throw d.stop(),a;}}):typeof e==="function"&&e()};this.removeNode=function(a,d){a&&a.length?a.fadeOut(function(){a.remove();if(typeof d==="function")try{d()}catch(e){throw a.stop(),e;}}):typeof d==="function"&&d()};this.replaceNode=function(g,d,e){if(!d||!d.length)return a.removeNode(g,e);g&&g.length?g.fadeOut(function(){d.css("display","none");g.replaceWith(d);d.fadeIn(function(){if(typeof e==="function")try{e()}catch(a){throw g.stop(),d.stop(),a;}})}):typeof e==="function"&&
e()};this.resetProgressBarAll=function(){a.progressbarAll&&a.progressbarAll.progressbar("value",0)};this.hideProgressBarAll=function(g){a.progressbarAll&&!f(l(a)).find(a.progressSelector+":visible:first").length?a.progressbarAll.fadeOut(g):typeof g==="function"&&g()};this.onAbort=function(a,d,e,c,b){b.removeNode(b.uploadRow,b.hideProgressBarAll)};this.cancelUpload=function(a,d,e,c,b){var f=c.readyState;c.abort();if(typeof f!=="number"||f<2)b.onAbort(a,d,e,c,b)};this.initProgressBar=function(a,d){if(!a||
!a.length)return null;return typeof a.progressbar==="function"?a.progressbar({value:d}):(a.addClass("progressbar").append(f("<div/>").css("width",d+"%")).progressbar=function(a,g){return this.each(function(){a==="destroy"?f(this).removeClass("progressbar").empty():f(this).children().css("width",g+"%")})},a)};this.destroyProgressBar=function(a){if(!a||!a.length)return null;return a.progressbar("destroy")};this.initUploadProgress=function(a,d){!a.upload&&d.progressbar&&d.progressbar.progressbar("value",
100)};this.initUploadProgressAll=function(){a.progressbarAll&&a.progressbarAll.is(":hidden")&&a.progressbarAll.fadeIn()};this.onSend=function(a,d,e,c,b){b.initUploadProgress(c,b)};this.onProgress=function(a,d,e,c,b){b.progressbar&&a.lengthComputable&&b.progressbar.progressbar("value",parseInt(a.loaded/a.total*100,10))};this.onProgressAll=function(g){a.progressbarAll&&g.lengthComputable&&a.progressbarAll.progressbar("value",parseInt(g.loaded/g.total*100,10))};this.onLoadAll=function(){k.complete()};
this.initProgressBarAll=function(){if(!a.progressbarAll)a.progressbarAll=a.initProgressBar(typeof a.progressAllNode==="function"?a.progressAllNode(a):a.progressAllNode,0)};this.destroyProgressBarAll=function(){a.destroyProgressBar(a.progressbarAll)};this.loadPreviewImage=function(a,d,e){d=d||0;e.uploadRow.find(e.previewSelector).each(function(){var c=f(this),b=a[d];setTimeout(function(){e.loadImage(b,function(a){e.addNode(c,f(a))},e.previewMaxWidth,e.previewMaxHeight,e.imageTypes,!e.previewAsCanvas)},
e.previewLoadDelay);d+=1})};this.initUploadRow=function(a,d,e,c,b){if(a=b.uploadRow=typeof b.buildUploadRow==="function"?b.buildUploadRow(d,e,b):null)b.progressbar=b.initProgressBar(a.find(b.progressSelector),0),a.find(b.cancelSelector).click(function(a){b.cancelUpload(a,d,e,c,b);a.preventDefault()}),b.loadPreviewImage(d,e,b)};this.initUpload=function(a,d,e,c,b,f){b.initUploadRow(a,d,e,c,b);b.addNode(l(b),b.uploadRow,function(){typeof b.beforeSend==="function"?b.beforeSend(a,d,e,c,b,f):f()});b.initUploadProgressAll()};
this.parseResponse=function(a){return typeof a.responseText!=="undefined"?f.parseJSON(a.responseText):f.parseJSON(a.contents().text())};this.initDownloadRow=function(a,d,c,f,b){var i;try{i=b.response=b.parseResponse(f,b)}catch(h){if(typeof b.onError==="function")b.originalEvent=a,b.onError(h,d,c,f,b);else throw h;}b.downloadRow=typeof b.buildDownloadRow==="function"?b.buildDownloadRow(i,b):null};this.onLoad=function(a,c,e,f,b){var i=l(b),h=typeof b.downloadTable==="function"?b.downloadTable(b):b.downloadTable,
j=function(){if(typeof b.onComplete==="function")b.onComplete(a,c,e,f,b);k.complete()};k.push(Array.prototype.slice.call(arguments,1));b.initDownloadRow(a,c,e,f,b);i&&b.uploadRow&&b.uploadRow.length&&(!h||i.get(0)===h.get(0))?b.replaceNode(b.uploadRow,b.downloadRow,j):b.removeNode(b.uploadRow,function(){b.addNode(h,b.downloadRow,j)})};this.dropZoneEnlarge=function(){i||(typeof a.dropZone.switchClass==="function"?a.dropZone.switchClass(a.cssClassSmall,a.cssClassLarge):(a.dropZone.addClass(a.cssClassLarge),
a.dropZone.removeClass(a.cssClassSmall)),i=!0)};this.dropZoneReduce=function(){typeof a.dropZone.switchClass==="function"?a.dropZone.switchClass(a.cssClassLarge,a.cssClassSmall):(a.dropZone.addClass(a.cssClassSmall),a.dropZone.removeClass(a.cssClassLarge));i=!1};this.onDocumentDragEnter=function(){a.dropZoneEnlarge()};this.onDocumentDragOver=function(){j&&clearTimeout(j);j=setTimeout(function(){a.dropZoneReduce()},200)};this.onDragEnter=this.onDragLeave=function(){a.dropZone.toggleClass(a.cssClassHighlight)};
this.onDrop=function(){j&&clearTimeout(j);a.dropEffect&&typeof a.dropZone.effect==="function"?a.dropZone.effect(a.dropEffect,function(){a.dropZone.removeClass(a.cssClassHighlight);a.dropZoneReduce()}):(a.dropZone.removeClass(a.cssClassHighlight),a.dropZoneReduce())};this.init=function(){a.initProgressBarAll();typeof a.initExtended==="function"&&a.initExtended()};this.destroy=function(){typeof a.destroyExtended==="function"&&a.destroyExtended();a.destroyProgressBarAll()};f.extend(this,h)};i={init:function(c){return this.each(function(){f(this).fileUpload(new m(f(this),
c))})},option:function(c,h,a){if(!c||typeof c==="string"&&typeof h==="undefined")return f(this).fileUpload("option",c,h,a);return this.each(function(){f(this).fileUpload("option",c,h,a)})},destroy:function(c){return this.each(function(){f(this).fileUpload("destroy",c)})},upload:function(c,h){return this.each(function(){f(this).fileUpload("upload",c,h)})}};f.fn.fileUploadUI=function(c){if(i[c])return i[c].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof c==="object"||!c)return i.init.apply(this,
arguments);else f.error('Method "'+c+'" does not exist on jQuery.fileUploadUI')}})(jQuery);
