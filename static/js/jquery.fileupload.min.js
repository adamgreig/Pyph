/*
 * jQuery File Upload Plugin 4.4.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://creativecommons.org/licenses/MIT/
 */

(function(h){var q,n,D=function(g,h){var k=0,l=[];h&&(h.length?l=h:l[h-1]=null);this.complete=function(){k+=1;k===l.length&&(g(l),k=0,l=[])};this.push=function(c){l.push(c)};this.getList=function(){return l}},N=function(){var h=[];this.push=function(i){h.push(i);h.length===1&&i()};this.next=function(){h.shift();if(h.length)h[0]()}};q=function(g){var i=this,k,l,c={namespace:"file_upload",uploadFormFilter:function(){return!0},fileInputFilter:function(){return!0},cssClass:"file_upload",dragDropSupport:!0,
dropZone:g,url:function(a){return a.attr("action")},method:function(a){return a.attr("method")},fieldName:function(a){return a.attr("name")},formData:function(a){return a.serializeArray()},requestHeaders:null,multipart:!0,multiFileRequest:!1,withCredentials:!1,forceIframeUpload:!1,sequentialUploads:!1,maxChunkSize:null,maxFileReaderSize:5E7},o={},p={},n=/^http(s)?:\/\//,v,r=new D(function(a){if(typeof c.onLoadAll==="function")c.onLoadAll(a)}),w=new N,m=function(){r.complete();w.next()},q=function(){return typeof XMLHttpRequest!==
"undefined"&&typeof XMLHttpRequestUpload!=="undefined"&&typeof File!=="undefined"&&(!c.multipart||typeof FormData!=="undefined"||typeof FileReader!=="undefined"&&typeof XMLHttpRequest.prototype.sendAsBinary==="function")},E=function(){if(c.dragDropSupport)typeof c.onDocumentDragEnter==="function"&&(o["dragenter."+c.namespace]=function(a){c.onDocumentDragEnter(a)}),typeof c.onDocumentDragLeave==="function"&&(o["dragleave."+c.namespace]=function(a){c.onDocumentDragLeave(a)}),o["dragover."+c.namespace]=
i.onDocumentDragOver,o["drop."+c.namespace]=i.onDocumentDrop,h(document).bind(o),typeof c.onDragEnter==="function"&&(p["dragenter."+c.namespace]=function(a){c.onDragEnter(a)}),typeof c.onDragLeave==="function"&&(p["dragleave."+c.namespace]=function(a){c.onDragLeave(a)}),p["dragover."+c.namespace]=i.onDragOver,p["drop."+c.namespace]=i.onDrop,c.dropZone.bind(p);l.bind("change."+c.namespace,i.onChange)},F=function(){h.each(o,function(a,b){h(document).unbind(a,b)});h.each(p,function(a,b){c.dropZone.unbind(a,
b)});l.unbind("change."+c.namespace)},s=function(a){return typeof a.uploadedBytes!=="undefined"},t=function(a,b,f){var d;typeof document.createEvent==="function"&&typeof ProgressEvent!=="undefined"?(d=document.createEvent("ProgressEvent"),d.initProgressEvent("progress",!1,!1,a,b,f)):d={lengthComputable:!0,loaded:b,total:f};return d},x=function(a,b,f){var d;if(typeof f.progressTotal==="undefined")if(a[b])d=a[b].size,f.progressTotal=d?d:1;else{for(b=d=0;b<a.length;b+=1)d+=a[b].size;f.progressTotal=
d}return f.progressTotal},y=function(a,b,f,d,e){var c=0,j=0;if(a.lengthComputable&&typeof e.onProgressAll==="function")e.progressLoaded=parseInt(a.loaded/a.total*x(b,f,e),10),b=r.getList(),h.each(b,function(a,b){c+=b[3].progressLoaded||0;j+=x(b[0],b[1],b[3])}),a=t(!0,c,j),e.onProgressAll(a,b)},O=function(a,b,f,d,e){var c;if(s(e)){e.uploadedBytes+=e.chunkSize;c=t(!0,e.uploadedBytes,b[f].size);if(typeof e.onProgress==="function")e.onProgress(c,b,f,d,e);y(c,b,f,d,e);if(e.uploadedBytes<b[f].size){typeof e.resumeUpload===
"function"?e.resumeUpload(a,b,f,d,e,function(){u(a,b,f,d,e,!0)}):u(a,b,f,d,e,!0);return}}e.progressLoaded=x(b,f,e);if(typeof e.onLoad==="function")e.onLoad(a,b,f,d,e);m()},P=function(a,b,f,d){if(f.upload)f.upload.onprogress=function(e){var c=e;s(d)&&e.lengthComputable&&(c=t(!0,d.uploadedBytes+parseInt(e.loaded/e.total*d.chunkSize,10),a[b].size));if(typeof d.onProgress==="function")d.onProgress(c,a,b,f,d);y(c,a,b,f,d)};f.onload=function(e){O(e,a,b,f,d)};f.onabort=function(e){d.progressTotal=d.progressLoaded;
if(typeof d.onAbort==="function")d.onAbort(e,a,b,f,d);m()};f.onerror=function(e){d.progressTotal=d.progressLoaded;if(typeof d.onError==="function")d.onError(e,a,b,f,d);m()}},G=function(a){if(typeof a.url==="function")return a.url(a.uploadForm||k);return a.url},H=function(a){if(typeof a.method==="function")return a.method(a.uploadForm||k);return a.method},z=function(a){if(typeof a.fieldName==="function")return a.fieldName(a.fileInput||l);return a.fieldName},A=function(a){var b;if(typeof a.formData===
"function")return a.formData(a.uploadForm||k);else if(h.isArray(a.formData))return a.formData;else if(a.formData)return b=[],h.each(a.formData,function(a,d){b.push({name:a,value:d})}),b;return[]},Q=function(a){if(n.test(a)){var b=location.host,f=location.protocol.length+2,d=a.indexOf(b,f),b=d+b.length;if((d===f||d===a.indexOf("@",f)+1)&&(a.length===b||h.inArray(a.charAt(b),["/","?","#"])!==-1))return!0;return!1}return!0},R=function(a,b,f,d){var a=a[b],b=G(d),e=Q(b);f.open(H(d),b,!0);if(e){if(f.setRequestHeader("X-Requested-With",
"XMLHttpRequest"),!d.multipart||s(d))f.setRequestHeader("X-File-Name",a.name),f.setRequestHeader("X-File-Type",a.type),f.setRequestHeader("X-File-Size",a.size),s(d)?d.multipart||f.setRequestHeader("Content-Type","application/octet-stream"):f.setRequestHeader("Content-Type",a.type)}else if(d.withCredentials)f.withCredentials=!0;h.isArray(d.requestHeaders)?h.each(d.requestHeaders,function(a,b){f.setRequestHeader(b.name,b.value)}):d.requestHeaders&&h.each(d.requestHeaders,function(a,b){f.setRequestHeader(a,
b)})},S=function(a,b,f){var d=new FormData,e;h.each(A(f),function(a,b){d.append(b.name,b.value)});for(e=0;e<a.length;e+=1)d.append(z(f),a[e]);b.send(d)},T=function(a,b){a.reader=new FileReader;a.reader.onload=b;a.reader.readAsBinaryString(a)},U=function(a,b,f,d){var e="",c=[];h.each(d,function(b,d){e+="--"+a+'\r\nContent-Disposition: form-data; name="'+unescape(encodeURIComponent(d.name))+'"\r\n\r\n'+unescape(encodeURIComponent(d.value))+"\r\n"});h.each(b,function(b,d){e+="--"+a+'\r\nContent-Disposition: form-data; name="'+
unescape(encodeURIComponent(f))+'"; filename="'+unescape(encodeURIComponent(d.name))+'"\r\nContent-Type: '+unescape(encodeURIComponent(d.type))+"\r\n\r\n";c.push(e);c.push(d.reader.result);delete d.reader;e="\r\n"});e+="--"+a+"--\r\n";c.push(e);return c.join("")},V=function(a,b,f){var d="----MultiPartFormBoundary"+(new Date).getTime(),e,c;b.setRequestHeader("Content-Type","multipart/form-data; boundary="+d);e=new D(function(){b.sendAsBinary(U(d,a,z(f),A(f)))},a.length);for(c=0;c<a.length;c+=1)T(a[c],
e.complete)},u=function(a,b,f,d,e,c){var g;g=function(){if(!c&&typeof e.onSend==="function"&&e.onSend(a,b,f,d,e)===!1)m();else{var g;var j=b[f];g=e;var i=g.uploadedBytes,k=g.maxChunkSize;if(j&&typeof j.slice==="function"&&(i||k&&k<j.size))g.uploadedBytes=i=i||0,j=j.slice(i,k||j.size-i),g.chunkSize=j.size;g=j;P(b,f,d,e);R(b,f,d,e);e.multipart?(g=typeof f==="number"?[g]:b,typeof FormData!=="undefined"?S(g,d,e):typeof FileReader!=="undefined"&&typeof d.sendAsBinary==="function"?V(g,d,e):h.error("Browser does not support multipart/form-data XHR file uploads")):
d.upload?d.send(g):h.error("Browser does not support XHR file uploads")}};if(!c&&(r.push(Array.prototype.slice.call(arguments,1)),e.sequentialUploads)){w.push(g);return}g()},I=function(a,b,f,d,e){var g=new XMLHttpRequest,j=h.extend({},c);j.fileInput=f;j.uploadForm=d;typeof j.initUpload==="function"?j.initUpload(a,b,e,g,j,function(){u(a,b,e,g,j)}):u(a,b,e,g,j)},J=function(a,b,f,d,e){var c=0;typeof f==="undefined"?h.each(b,function(a,b){c+=b.size?b.size:1}):c=b[f].size?b[f].size:1;a=t(!0,c,c);e.progressLoaded=
c;y(a,b,f,d,e)},W=function(a,b,c){var d=A(c);b.find(":input").not(":disabled").attr("disabled",!0).addClass(c.namespace+"_disabled");h.each(d,function(a,d){h('<input type="hidden"/>').attr("name",d.name).val(d.value).addClass(c.namespace+"_form_data").appendTo(b)});a.attr("name",z(c)).appendTo(b)},X=function(a,b,c){a.detach();b.find("."+c.namespace+"_disabled").removeAttr("disabled").removeClass(c.namespace+"_disabled");b.find("."+c.namespace+"_form_data").remove()},K=function(a,b,c,d,e,g,j){var i;
i=function(){if(typeof g.onSend==="function"&&g.onSend(a,b,j,e,g)===!1)m();else{var i=d.attr("action"),k=d.attr("method"),l=d.attr("target");e.unbind("abort").bind("abort",function(a){e.readyState=0;e.unbind("load").attr("src","javascript".concat(":false;"));J(a,b,j,e,g);if(typeof g.onAbort==="function")g.onAbort(a,b,j,e,g);m()}).unbind("load").bind("load",function(a){e.readyState=4;J(a,b,j,e,g);if(typeof g.onLoad==="function")g.onLoad(a,b,j,e,g);h('<iframe src="javascript:false;" style="display:none;"></iframe>').appendTo(d).remove();
m()});d.attr("action",G(g)).attr("method",H(g)).attr("target",e.attr("name"));W(c,d,g);e.readyState=2;d.get(0).submit();X(c,d,g);d.attr("action",i).attr("method",k).attr("target",l)}};r.push([b,j,e,g]);g.sequentialUploads?w.push(i):i()},L=function(a,b,f,d){if(!a||!b||!f)h.error("Iframe based File Upload requires a file input change event");else{var e=h('<iframe src="javascript:false;" style="display:none;" name="iframe_'+c.namespace+"_"+(new Date).getTime()+'"></iframe>'),g=h.extend({},c),j=a.target&&
a.target.files,j=j?Array.prototype.slice.call(j,0):[{name:b.val(),type:null,size:null}],d=j.length===1?0:d;g.fileInput=b;g.uploadForm=f;e.readyState=0;e.abort=function(){e.trigger("abort")};e.bind("load",function(){e.unbind("load");typeof g.initUpload==="function"?g.initUpload(a,j,d,e,g,function(){K(a,j,b,f,e,g,d)}):K(a,j,b,f,e,g,d)}).appendTo(f)}},B=function(a,b,f,d){var e;a:{var g=e=0,h;if(c.multipart&&typeof FormData==="undefined"){for(h=0;h<b.length;h+=1){e=b[h].size;if(e>c.maxFileReaderSize){e=
!1;break a}g+=e}if(c.multiFileRequest&&g>c.maxFileReaderSize){e=!1;break a}}e=!0}if(e)if(b=Array.prototype.slice.call(b,0),c.multiFileRequest&&c.multipart&&b.length)I(a,b,f,d);else for(e=0;e<b.length;e+=1)I(a,b,f,d,e);else L(a,f,d)},M=function(){k=(g.is("form")?g:g.find("form")).filter(c.uploadFormFilter)},C=function(){l=(k.length?k:g).find("input:file").filter(c.fileInputFilter)};this.onDocumentDragOver=function(a){if(typeof c.onDocumentDragOver==="function"&&c.onDocumentDragOver(a)===!1)return!1;
a.preventDefault()};this.onDocumentDrop=function(a){if(typeof c.onDocumentDrop==="function"&&c.onDocumentDrop(a)===!1)return!1;a.preventDefault()};this.onDragOver=function(a){if(typeof c.onDragOver==="function"&&c.onDragOver(a)===!1)return!1;var b=a.originalEvent.dataTransfer;if(b&&b.files)b.dropEffect=b.effectAllowed="copy",a.preventDefault()};this.onDrop=function(a){if(typeof c.onDrop==="function"&&c.onDrop(a)===!1)return!1;var b=a.originalEvent.dataTransfer;b&&b.files&&q()&&B(a,b.files);a.preventDefault()};
this.onChange=function(a){if(typeof c.onChange==="function"&&c.onChange(a)===!1)return!1;var b=h(a.target),f=h(a.target.form);if(f.length===1){b.data("file_upload_form",f);var d=b.clone(!0);h("<form/>").append(d).get(0).reset();b.after(d).detach();C()}else f=b.data("file_upload_form");!c.forceIframeUpload&&a.target.files&&q()?B(a,a.target.files,b,f):L(a,b,f)};this.init=function(a){a&&(h.extend(c,a),v=a);M();C();g.data(c.namespace)?h.error('FileUpload with namespace "'+c.namespace+'" already assigned to this element'):
(g.data(c.namespace,i).addClass(c.cssClass),c.dropZone.not(g).addClass(c.cssClass),E(),typeof c.init==="function"&&c.init())};this.options=function(a){var b,f,d,e;if(typeof a==="undefined")return h.extend({},c);v&&h.extend(v,a);F();h.each(a,function(a,g){switch(a){case "namespace":h.error("The FileUpload namespace cannot be updated.");return;case "uploadFormFilter":e=d=!0;break;case "fileInputFilter":e=!0;break;case "cssClass":b=c.cssClass;break;case "dropZone":f=c.dropZone}c[a]=g});d&&M();e&&C();
typeof b!=="undefined"?(g.removeClass(b).addClass(c.cssClass),(f?f:c.dropZone).not(g).removeClass(b),c.dropZone.not(g).addClass(c.cssClass)):f&&(f.not(g).removeClass(c.cssClass),c.dropZone.not(g).addClass(c.cssClass));E()};this.option=function(a,b){var f;if(typeof b==="undefined")return c[a];f={};f[a]=b;i.options(f)};this.destroy=function(){typeof c.destroy==="function"&&c.destroy();F();g.removeData(c.namespace).removeClass(c.cssClass);c.dropZone.not(g).removeClass(c.cssClass)};this.upload=function(a){typeof a.length===
"undefined"&&(a=[a]);B(null,a)}};n={init:function(g){return this.each(function(){(new q(h(this))).init(g)})},option:function(g,i,k){var k=k?k:"file_upload",l=h(this).data(k);if(l)if(g){if(typeof g==="string"&&typeof i==="undefined")return l.option(g)}else return l.options();else h.error('No FileUpload with namespace "'+k+'" assigned to this element');return this.each(function(){var c=h(this).data(k);c?typeof g==="string"?c.option(g,i):c.options(g):h.error('No FileUpload with namespace "'+k+'" assigned to this element')})},
destroy:function(g){g=g?g:"file_upload";return this.each(function(){var i=h(this).data(g);i?i.destroy():h.error('No FileUpload with namespace "'+g+'" assigned to this element')})},upload:function(g,i){i=i?i:"file_upload";return this.each(function(){var k=h(this).data(i);k?k.upload(g):h.error('No FileUpload with namespace "'+i+'" assigned to this element')})}};h.fn.fileUpload=function(g){if(n[g])return n[g].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof g==="object"||!g)return n.init.apply(this,
arguments);else h.error('Method "'+g+'" does not exist on jQuery.fileUpload')}})(jQuery);
